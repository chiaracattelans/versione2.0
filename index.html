<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Database Carte - Vita</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input { width: 100%; padding: 10px; font-size: 16px; margin-bottom: 20px; }
    .card, .deck-card { margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-radius: 8px; }
    .button { margin-top: 5px; padding: 4px 8px; font-size: 14px; cursor: pointer; }
    #mazzo { margin-top: 40px; }

    .popup, .overlay {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 1.5em;
      border: 2px solid black;
      z-index: 100;
      max-width: 80%;
      max-height: 80%;
      overflow: auto;
    }
    .overlay {
      background: rgba(0,0,0,0.5);
      z-index: 99;
      width: 100vw; height: 100vh;
      top: 0; left: 0;
    }
  </style>
</head>
<body>
  <h1>Carte Vita</h1>
  <input id="searchBar" placeholder="Cerca una carta..." />
  <div id="risultati"></div>

  <h2>🧺 Mazzo</h2>
  <div id="mazzo"></div>

  <!-- POPUP Dettagli -->
  <div class="overlay" id="overlay" onclick="chiudiPopup()"></div>
  <div class="popup" id="popup">
    <pre id="popup-content"></pre>
    <button class="button" onclick="chiudiPopup()">Chiudi</button>
  </div>

  <script>
    let tutteLeCarte = [];
    let carteFiltrate = [];
    let mazzo = [];

    fetch("cards.json")
      .then(res => res.json())
      .then(data => {
        tutteLeCarte = data;
        carteFiltrate = data;
        mostraCarte(data);
      });

    function mostraCarte(carte) {
      carteFiltrate = carte;
      const div = document.getElementById("risultati");
      div.innerHTML = "";
      carte.forEach((carta) => {
        const cardDiv = document.createElement("div");
        cardDiv.classList.add("card");

        cardDiv.innerHTML = `
          <strong>${carta.nome}</strong><br>
          <em>${carta.tipo}</em><br>
          ${carta.effetti}<br>
        `;

        const btnAdd = document.createElement("button");
        btnAdd.textContent = "➕ Aggiungi al mazzo";
        btnAdd.classList.add("button");
        btnAdd.addEventListener("click", () => {
          mazzo.push(carta);
          mostraMazzo();
        });

        const btnDettagli = document.createElement("button");
        btnDettagli.textContent = "🔍 Dettagli";
        btnDettagli.classList.add("button");
        btnDettagli.addEventListener("click", () => {
          apriPopup(carta);
        });

        cardDiv.appendChild(btnAdd);
        cardDiv.appendChild(btnDettagli);
        div.appendChild(cardDiv);
      });
    }

    function mostraMazzo() {
      const div = document.getElementById("mazzo");
      div.innerHTML = "";
      mazzo.forEach((carta, i) => {
        const cardDiv = document.createElement("div");
        cardDiv.classList.add("deck-card");

        cardDiv.innerHTML = `
          <strong>${carta.nome}</strong> - <em>${carta.tipo}</em>
          <br>${carta.effetti}<br>
        `;

        const removeBtn = document.createElement("button");
        removeBtn.textContent = "❌ Rimuovi";
        removeBtn.classList.add("button");
        removeBtn.addEventListener("click", () => {
          mazzo.splice(i, 1);
          mostraMazzo();
        });

        cardDiv.appendChild(removeBtn);
        div.appendChild(cardDiv);
      });
    }

    document.getElementById("searchBar").addEventListener("input", function() {
      const q = this.value.toLowerCase();
      const filtrate = tutteLeCarte.filter(c =>
        c.nome.toLowerCase().includes(q) ||
        c.effetti.toLowerCase().includes(q) ||
        c.tipo.toLowerCase().includes(q)
      );
      mostraCarte(filtrate);
    });

    function apriPopup(carta) {
      const dettagli = {};
      for (const chiave in carta) {
        if (carta[chiave] && carta[chiave].toString().trim() !== '') {
          dettagli[chiave] = carta[chiave];
        }
      }
      document.getElementById("popup-content").textContent = JSON.stringify(dettagli, null, 2);
      document.getElementById("overlay").style.display = "block";
      document.getElementById("popup").style.display = "block";
    }

    function chiudiPopup() {
      document.getElementById("overlay").style.display = "none";
      document.getElementById("popup").style.display = "none";
    }
  </script>
</body>
</html>
